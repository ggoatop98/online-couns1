
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 헬퍼 함수: 로그인한 관리자인지 확인
    function isAdmin() {
      return request.auth != null;
    }

    // 1. 상담 신청서 (학생, 학부모, 교사 공통)
    match /counseling_student/{document} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    match /counseling_parent/{document} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    match /counseling_teacher/{document} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    // 2. 설정 데이터
    match /config/notifications {
      allow read: if true; // 알림 발송 로직에서 읽기 필요
      allow write: if isAdmin();
    }

    match /config/teacher_auth {
      // [주의] 클라이언트 측 비밀번호 확인을 위해 read를 허용합니다.
      // 더 강력한 보안을 위해서는 Firebase Auth를 사용하거나 Cloud Functions를 통한 검증이 필요합니다.
      // 현재는 학교 내부용 '소프트 락' 수준의 보안을 제공합니다.
      allow read: if true;
      allow write: if isAdmin();
    }
  }
}
