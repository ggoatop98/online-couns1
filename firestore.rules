rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 헬퍼 함수: 로그인한 관리자인지 확인
    function isAdmin() {
      return request.auth != null;
    }

    // 1. 상담 신청서 (학생, 학부모, 교사 공통)
    // 누구나 신청(create)은 가능하지만, 읽기/수정/삭제는 오직 관리자만 가능
    match /counseling_student/{document} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    match /counseling_parent/{document} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    match /counseling_teacher/{document} {
      allow create: if true;
      allow read, update, delete: if isAdmin();
    }
    
    // 2. 설정 데이터 (알림 설정, 교사 인증 비밀번호)
    // 상담 신청 시 알림 발송과 비밀번호 확인이 필요하므로 read는 허용하되,
    // 오직 관리자만 수정(write)할 수 있도록 잠금
    match /config/notifications {
      allow read: if true;
      allow write: if isAdmin();
    }

    match /config/teacher_auth {
      allow read: if true;
      allow write: if isAdmin();
    }
  }
}